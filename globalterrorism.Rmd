---
title: "Global_Terrorism"
author: "Jonathan Brocksieper & Torben Westphalen"
date: "12/16/2020"
output:
  pdf_document: default
  html_document: default
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## Introduction 

We are going to analyze the Global Terrorism Database (GTD). It is an open 
source database which holds information on terrorism attacks from 1970 to 2017,
excluding 1993. The GTD lost the data of the year 1993 due to a compilation 
error. That's why we don't have any data from that particular year. 
The database is maintained by the National Consortium for the Study of 
Terrorism and Responses to Terrorism (START). The GTD includes over 180,000 
attacks around the world. 

Our research question is: Have terrorism attacks developed over the years?
We are going to focus with the regions of the terrorism attacks, if they 
succeeded or not, look if the amount of victims increased or decreased and we 
looked at the suicide attack statistics.
These variables are dependent on the year of the attack. 


## Libraries

These are libraries we are going to use for our research. We are using an older
version of the "gganimate" package since the new one has not been well 
documented for our needs.

Since we have a focus on the location of the terrorism attacks, we thought that
we can visualize them in a map. Therefore we use the libraries "ggmap" and 
"mapdata".

```{r}
#remove.packages("gganimate")
#install.packages("data.table")
#install.packages("sf")
#install.packages("ggmap")
#install.packages("mapdata")
#install.packages("devtools")
#install.packages("lubridate")
#install_github("thomasp85/gganimate", ref = "v0.1.1")
#install.packages("https://github.com/thomasp85/gganimate/archive/v0.1.1.tar.gz", repos = NULL, type = "source")

#library("devtools")
library(data.table)
library(dplyr)
library(ggplot2)
library(sf)
library(ggmap)
library(mapdata)
library(gganimate)
library(lubridate)
```


## Importing dataset

We have uploaded a compressed zip file to a public repository, in case that the 
dataset gets removed from our source.  
We are also replacing the empty cells with "NA" cells to make the use of the 
is.na easier. This helps us tidying up the dataset.

```{r}
if (!file.exists("globalterrorism_dataset.zip")) {
    download.file("https://github.com/JBrO910/DASC_Research/raw/main/globalterrorism_dataset.zip",
                  "globalterrorism_dataset.zip")
    unzip("globalterrorism_dataset.zip")
}

globalterrorism <- read.csv("globalterrorism.csv", na.strings = c("", "NA"), header = TRUE)
```

## Deleting columns with more than 90% missing values

As we looked over the dataset, we have found out that many columns have a lot or
almost none filled rows. So we decided that all columns that have more than 
90 % missing values shall be removed. Our intention is that we only use the 
columns that have enough cells with useful data.

```{r}
na_count <- sapply(globalterrorism, function(y) sum(length(which(is.na(y)))))
na_count <- data.frame(na_count)

# Get row name as a column 
na_count_table <- setDT(na_count, keep.rownames = TRUE)[]
na_count_table <- data.frame(na_count_table)

# Calculate the percentage of missing values. Limit to two decimals after the dot.
na_percentage <- sapply(na_count_table$na_count, function(x) as.double(format(round( x/nrow(globalterrorism ), 2), nsmall = 2)))
na_percentage_table <- data.frame(na_count_table, na_percentage)

# Filtering so that only the rows exist that are have less than 90 % missing values
na_percentage_filtered <- subset(na_percentage_table, na_percentage_table$na_percentage < 0.90)

# Removal of the columns and creating a date column
globalterrorism_done <- globalterrorism %>% 
  select(one_of(na_percentage_filtered$rn)) %>%
  mutate(date = make_date(iyear, imonth, iday)) %>%
  mutate_if(is.integer, ~replace(., is.na(.), 0)) %>%
  filter(!is.na(date))
```

## World map with all locations of terrorism attacks

We created a map and set a point for each location of a terrorism attack. 
In the dataset we have the longitude and latitude coordinates of each 
terrorism attack. With these coordinates we can set a point on the map.
We also animated the map by cycling through the years. This helps with the the 
overall visibility of the map. If a terrorism attack has been avoided the point
is green. Otherwise the point will be colored red. 

WARNING: The compilation of this map may take a few minutes!

```{r}
# Retrieving all coordinates from the dataset. But the NA values have to be filtered out first.
globalterrorism_coordinates <- globalterrorism_done %>% filter(!is.na(globalterrorism_done$longitude)) 

# We have found out that one of the coordinates has been added incorrect. Therefore we are also filtering that out.
globalterrorism_coordinates <- globalterrorism_coordinates %>% filter(globalterrorism_coordinates$longitude > -180)
#globalterrorism_coordinates

# Create start and end variables for the animation
map_animation_start <- tibble(iyear = 1969, longitude = 0, latitude = 0)
map_animation_end <- tibble(iyear = 2018, longitude = 0, latitude = 0)

# Setting up the map
map_base <- map("worldHires", fill = T, plot = F)
map_base <- st_as_sf(map_base)
map_base <- st_make_valid(map_base)

# Adding the points to the map. The start and end variables for the animation are also added here. We are also doing additional labeling for longitude and latitude.
points_map <- ggplot() + geom_sf(data = map_base) + 
  geom_point(aes(x = longitude, y = latitude,
                 frame = iyear,
                 cumulative = TRUE),
             data = globalterrorism_coordinates, colour = ifelse(globalterrorism_coordinates$success == 1, "red", "green"),  size = 1) +
  geom_point(aes(x = longitude, y = latitude,
                 frame = iyear,
                 cumulative = TRUE),
             data = map_animation_start, colour = "purple", size = 0) +
  geom_point(aes(x = longitude, y = latitude,
                 frame = iyear,
                 cumulative = TRUE),
             data = map_animation_end, colour = "purple", size = 0) +
  labs(x = "Longitude", y = "Latitude", fill = "") +
  theme_bw() +
  theme(panel.grid = element_line(colour = "transparent"),
    axis.title = element_text(size = 18),
    axis.text = element_text(size = 16),
    legend.text = element_text(size = 14),
    legend.title = element_text(size = 14))

# Start animation with an interval of 0.2 seconds.
gganimate(points_map, interval = 0.2) 
```


## Number of terrorism attacks every year (excluding 1993)

We also checked how many terrorism attacks were successful for each year. 
Each bar has two colors for that.
We discovered that more terrorism attacks were unsuccessful over
the years. It makes sense, because anti terrorism units (GSG-9, GIGN) have 
been founded and security measures (airport controls) are now better 
than they used to be.

```{r fig.height=8, fig.width=15}
tibble(unique(globalterrorism_done$iyear), table(globalterrorism_done$iyear))

ggplot(data = globalterrorism_done) +
  geom_bar(mapping = aes(x = iyear, fill = factor(success))) +
  labs(fill = "Success (1 = Attack was successful)") +
  xlab("Years") +
  ylab("Amount of attacks") +
  ggtitle("Number of terrorism attacks")
```

## Amount of victims 

Like the number of terrorism-diagram we are using a bar chart, but this 
time we check how many people fell victim to terrorism attacks over the years.
The bars are colored after the region where the attack took place. 
In the 1980s there is a high amount of victims in Central and South America.
This mostly relates to the drug wars, which were at their highest point during 
this period, and the civil war in El Salvador.
You can also see the beginning an increase of victims in the middle east during 
the 1990s, which results from the aftermath of the second gulf war.
The increase of victims from North America in 2001 mostly relates to 9/11 with 
almost 3000 victims.
2014 had the most victims by far. Reason for that is the war in Syria and the 
rise of ISIS.

```{r fig.height=8, fig.width=15}
globalterrorism_kill <- globalterrorism_done %>% filter(!is.na(nkill)) 

ggplot(data = globalterrorism_kill) +
  geom_bar(mapping = aes(x = iyear, y = nkill, fill = factor(region_txt)), alpha = 0.7, stat = "identity") +
  scale_fill_manual(values = c("purple", "blue", "cyan", "pink", "brown", "red", "green", "orange", "yellow", "limegreen", "plum", "aquamarine")) +
  labs(fill = "Region") +
  xlab("Years") +
  ylab("Amount of victims") +
  ggtitle("Amount of victims for each year")
```


## Amount of suicide attacks and victims over the years 

We have made two graphs dependent on the suicide attacks. The red graph shows 
how many suicide attacks happened over the years and the blue one shows the 
amount of people who fell victim to these attacks.
The first suicide attack that has been registered occurred in 1981. From that 
point on, the amount of attacks steadily increased over the time. 2016 had the 
most attacks.
The first bump of victims occurred in 1983 through the Beirut barracks bombings
in Lebanon with over 300 victims. The next increase of victims belongs to 
the attack on the 11th of September 2001 on the Twin Towers. The next 
bump of victims is in 2007. This mostly relates to the occupation of Iraq by 
the US and British armed forces. 2016 had also the most victims that mostly 
relates to the Syrian war.

```{r fig.height=8, fig.width=15}
# Filter all suicide attacks
globalterrorism_suicide <- globalterrorism_done %>%
  filter(suicide == TRUE)

# Count the number of suicide attacks for each year
amount_suicide = tibble(unique(globalterrorism_suicide$iyear), table(globalterrorism_suicide$iyear))
amount_suicide <- rename(amount_suicide, nsuicide = `table(globalterrorism_suicide$iyear)`)
 
# Count the number of kill of suicide attacks
amount_kill <- globalterrorism_suicide %>%
  group_by(iyear) %>%
  summarise(nkills = sum(nkill))

amount = tibble(amount_kill, amount_suicide$nsuicide)

ggplot(data = amount, mapping = aes(x = iyear)) +
     geom_line(mapping = aes(y = `amount_suicide$nsuicide`, colour = "Blue"), size = 1.5) +
     geom_line(mapping = aes(y = nkills, colour = "Red"), size = 1.5) +
     scale_color_discrete(name = "Y Series", labels = c("Amount of suicide attacks", "Amount of victims")) +
     xlab("Years") +
     ylab("Amount") +
     ggtitle("Amount of suicides attacks and victims over the years")

```