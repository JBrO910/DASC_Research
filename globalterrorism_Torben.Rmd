---
title: "Global_Terrorism"
author: "Jonathan Brocksieper & Torben Westphalen"
date: "12/16/2020"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## R Markdown

This is an R Markdown document. Markdown is a simple formatting syntax for authoring HTML, PDF, and MS Word documents. For more details on using R Markdown see <http://rmarkdown.rstudio.com>.

When you click the **Knit** button a document will be generated that includes both content as well as the output of any embedded R code chunks within the document. You can embed an R code chunk like this:

## Libraries
```{r}
install.packages("data.table")
library(data.table)
library(dplyr)
library(ggplot2)
install.packages("maps")
require(maps)
require(viridis)
```


## Importing dataset

We are also replacing the empty cells with "NA" cells to make the use of the is.na easier. This helps us tidying up the dataset.

```{r}
if (!file.exists("globalterrorism_dataset.zip")) {
    download.file("https://github.com/JBrO910/DASC_Research/raw/main/globalterrorism_dataset.zip",
                  "globalterrorism_dataset.zip")
    unzip("globalterrorism_dataset.zip")
}

globalterrorism <- read.csv("globalterrorism.csv", na.strings = c("", "NA"), header = TRUE)
#globalterrorism
```

## Deleting columns with more than 90% missing values

As we looked over the dataset we have found out that many columns have a lot or almost none filled rows. So we decided that all columns that have more than 90 % missing values shall be removed. Our intention for this is that we only use the columns that actually have some filled out cells.

```{r}
na_count <- sapply(globalterrorism, function(y) sum(length(which(is.na(y)))))
na_count <- data.frame(na_count)

# Get row name as a column 
na_count_table <- setDT(na_count, keep.rownames = TRUE)[]
na_count_table <- data.frame(na_count_table)

# Calculate the percentage of missing values
na_percentage <- sapply(na_count_table$na_count, function(x) as.double(format(round( x/nrow(globalterrorism ), 2), nsmall = 2)))
na_percentage_table <- data.frame(na_count_table, na_percentage)
na_percentage_table

# Filtering so that only the rows exist that are have less than 90 % missing values
na_percentage_filtered <- subset(na_percentage_table, na_percentage_table$na_percentage < 0.90)
na_percentage_filtered

# Removal of the columns
globalterrorism_done <- globalterrorism %>% select(one_of(na_percentage_filtered$rn))
globalterrorism_done
```

```{r}
#globalterrorism_done <- globalterrorism %>% 
#  sapply(function(y) sum(length(which(is.na(y))))) %>% 
#  setDT(keep.rownames = TRUE)[] %>% 
#  sapply(function(x) as.double(format(round( x/nrow(globalterrorism ), 2), nsmall = 2))) %>% 
#  subset(na_percentage < 0.90) %>% 
#  select(one_of(rn)) 

```

## Including Plots

You can also embed plots, for example:

```{r pressure, echo=FALSE}
#plot(pressure)

world_map <- map_data("world")
#ggplot(world_map, aes(x = long, y = lat, group = group)) +
#  geom_polygon(fill="lightgray", colour = "white")

#world <- ne_countries(scale = "medium", returnclass = "sf")

#install.packages("sf")
#install.packages("geometry")



```

Note that the `echo = FALSE` parameter was added to the code chunk to prevent printing of the R code that generated the plot.
```{r}
#install.packages(c("cowplot", "googleway", "ggrepel", 
#"ggspatial", "libwgeom", "rnaturalearth", "rnaturalearthdata"))

library("ggplot2")
theme_set(theme_bw())
library("sf")

library("rnaturalearth")
library("rnaturalearthdata")

world <- ne_countries(scale = "medium", returnclass = "sf")
class(world)

ggplot(data = world) +
    geom_sf() +
    geom_point(data = globalterrorism_done, aes(x = longitude, y = latitude), size = 4, 
        shape = 23, fill = "darkred") +
    coord_sf(xlim = c(-88, -78), ylim = c(24.5, 33), expand = FALSE)
```
